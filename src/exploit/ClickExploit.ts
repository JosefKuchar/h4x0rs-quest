import Exploit from '../Exploit';
import { Colors } from '../Colors';
import GameScreen from '../screen/GameScreen';

export default class ClickExploit extends Exploit {
    progress: number;
    reference: any;

    constructor(ctx: CanvasRenderingContext2D, game: GameScreen) {
        super(ctx, 'CLICK_OVERFLOW.EXE', game);
        this.progress = 0;
        let reference;
        this.game.game.canvas.addEventListener('click', (reference = this.eventHandler.bind(this)));
        this.reference = reference;
    }

    render() {
        super.renderWindow();

        this.ctx.strokeStyle = Colors.Foreground;
        this.ctx.beginPath();
        this.ctx.rect(50, 768 / 2 - 50 / 2, 1024 - 50 * 2, 100);
        this.ctx.closePath();
        this.ctx.stroke();
        this.ctx.fillStyle = Colors.Foreground;
        this.ctx.fillRect(
            50,
            768 / 2 - 50 / 2,
            (this.progress / 100) * (1024 - 50 * 2),
            100
        );

        if (this.progress >= 100) {
            this.game.game.canvas.removeEventListener('click', this.reference);
            this.game.exploitDone();
        }
    }

    eventHandler() {
        this.progress += 5;
    }
}
